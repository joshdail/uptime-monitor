# Uptime Monitor v.1.1.0

This is an API that allows you to create checks to monitor whether websites are up.

Users can create an account and add checks to their account. Checks are run and updated every minute.

Currently, there is no front end built for this application. All code here is server side.

This program is based on a project from a class on Node.js. However, unlike the class project, which used no frameworks or packages beyond the native Node modules and stored all data in the local file system, this API uses Express, Body Parser, and a few other modules and uses MongoDB to store user and check data. Also, I tried to take more care to keep the code cleaner and more readable.

## Running the app

Currently, a compiled version of the app is not available. The entry point for the app is the app.js file.

## Configuration

### Database

This app uses mongoDB for storing data. The connection uri for the database should be set as process.env.CONNECTION_STRING

### Port

The port to listen on should be set on the config.js file for each environment.

### Max Checks

The maximum number of checks a user can have on one account should be set on the config.js file for each environment.

## Routes

### Users

The /users route supports POST, GET, PATCH, and DELETE requests.

#### POST

Creates a new user account. Submit a JSON object in the request body with the following info:

{
  "email": String,
  "firstName": String,
  "lastName": String,
  "password": String (Must be at least 8 characters),
  "tosAgreement": Boolean (must be set to true)
}

The Boolean value of tosAgreement is not saved along with the user data (as long as a user has an account they must agree to the terms of service, so there would never be a false value), but a true value must be submitted for an account to be created. Basically, a way of confirming that the user checked the box.

The email is used for GET, PATCH, and DELETE requests to identify the record to request. The email must be unique in the database, but it can be modified by a PATCH request.

#### GET

Returns a user's account info as a JSON object. Submit the user's email in the route as follows: /users/email@example.com

A valid token must be submitted in the authorization header.

#### PATCH

Changes info for a user account. Submit the user's current email in the route as follows: /users/email@example.com

A valid token must be submitted in the authorization header. Any fields to be changed should be submitted in the request body as a JSON object (only fields being updated need to be included):

{
  "email": String,
  "firstName": String,
  "lastName": String,
  "password": String (Must be at least 8 characters)
}

#### DELETE

Deletes a user account. Submit the user's email in the route as follows: /users/email@example.com

A valid token must be submitted in the authorization header.

### Tokens

The /tokens route supports POST, GET, PATCH, and DELETE requests.

#### POST

Creates a token and returns a JSON object containing a token string to be included in the authorization header. Tokens last for one hour and can be extended (see PATCH). Submit the user's email and password in the request body as a JSON object.

{
  "email": String,
  "password": String
}

#### GET

Returns the token along with the expiration time. The expiration time is returned as a number, not as a string or timestamp. The token to be extended must be in the authorization header. No parameters should be sent in the query string or the payload.

#### PATCH

Extends a token's expiration time to one hour past the current time. The token to be extended must be in the authorization header. No parameters should be sent in the query string or the payload.

#### DELETE

Deletes a token. The token to be deleted must be in the authorization header. No parameters should be sent in the query string or the payload.

All tokens are automatically deleted when the app is shut down.

### Checks

The /checks route supports POST, GET, PATCH, and DELETE requests.

#### POST

Creates a check and returns a JSON object of the check. A valid token must be submitted in the authorization header. Submit the following fields in the request body as a JSON object:

{
  "protocol": String (must be "http" or "https"),
  "url": String (should NOT include the protocol),
  "method": String (must be "get", "post", "put", "patch", or "delete"),
  "successCodes": Array (OPTIONAL, if no value is specified, default is [200, 201, 202, 203, 204, 206, 207]),
  "timeoutSeconds": Number (OPTIONAL, if specified, must be between 1 and 15, if no value is specified, default is 10)
}

The API will generate a name for the check. The check name is used for GET, PATCH, and DELETE requests.

#### GET

Returns the check. Submit the check name generated by the API in the route as follows: /checks/checkName

A valid token must be submitted in the authorization header.

#### PATCH

Changes info for the check. Submit the check name generated by the API in the route as follows: /checks/checkName

A valid token must be submitted in the authorization header. Any fields to be updated should be submitted in the request body as a JSON object (only fields to be updated need to be submitted):

{
  "protocol": String (must be "http" or "https"),
  "url": String (should NOT include the protocol),
  "method": String (must be "get", "post", "put", "patch", or "delete"),
  "successCodes": Array,
  "timeoutSeconds": Number
}

#### DELETE

Deletes the check. Submit the check name generated by the API in the route as follows: /checks/checkName

A valid token must be submitted in the authorization header.

## CLI

A CLI has been added to the program, with the following commands available:

- help, man           Show a help page
- users               List all user accounts in the database
- checks              Show all checks in the database
- exit, cls           End the program
- logs                Show all log file names
- display {filename}  Display the log file. Note that the file extension is needed

## Other Info

The workers file will read the database for all checks on file and run each check. Each time a check is run, its status will be updated to "up" or "down" along with the time it was last checked. The results of each check are automatically logged.

## Coming soon

Compressing log files
